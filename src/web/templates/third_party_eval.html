<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../static/third_party_eval.css">
    <title>Third Party Evaluation</title>
</head>

<!-- JS for maneuvering text -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>

    questionAnswers = {};

    // Ensure all questions have a selected response
    function ensureAllAnswered(){
        //humanVal = $('input[type=radio]:checked', '#humanlike').val();
        //correctVal = $('input[type=radio]:checked', '#correct').val();
        //strategicVal = $("input[type=radio]:checked", "#strategic").val();
        //fluentVal = $("input[type=radio]:checked", "#fluent").val();
        fluentVal = $("#fluent").val();
        correctVal = $("#correct").val();
        strategicVal = $("#strategic").val();
        humanVal = $("#humanlike").val();
        //fluentVal = document.getElementById("#myRange").value
        console.log("FLUENT: " + fluentVal);
        console.log("FLUENT: " + correctVal);
        console.log("FLUENT: " + strategicVal);
        console.log("FLUENT: " + humanVal);

        if (humanVal == null | correctVal == null | strategicVal == null | fluentVal == null){
            return false;
        }
        else{
            questionAnswers["humanlike"] = humanVal;
            questionAnswers["correct"] = correctVal;
            questionAnswers["strategic"] = strategicVal;
            questionAnswers["fluent"] = fluentVal;

            return true;
        }
    }

    $(document).ready(function() {
        $("#submit").click(function() {
            allAnswered = ensureAllAnswered()
            if (allAnswered){
                console.log(questionAnswers);
                $.ajax({
                url: "/submit",
                type: "POST",
                data: JSON.stringify(questionAnswers),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data){
                    //alert("SUCCESS");
                    console.log(JSON.stringify(data));
                    window.location.reload(true);
                },
                failure: function(){
                    console.log(":(");
                }
                })
            }else{
                alert("You have not selected an answer for every question. Please do so before submitting the HIT.");
            }

        });
    });


    function formatDialogue(){
        hiddenDialogue = $("#hiddendialogue").text();
        console.log(hiddenDialogue);
        statements = hiddenDialogue.split(";");
        for(var idx = 0; idx < statements.length; idx++){
            utterance = statements[idx];
            colonIdx = utterance.indexOf(":");
            agent = utterance.substring(0, colonIdx+1);
            rest = utterance.substring(colonIdx+1);

            $(".dialogue").append("<p>" + "<strong>" + agent + "</strong>" + rest + "</p>");
        }
    }

    window.onload = function(){
        questionAnswers["uuid"] = {{ uuid|safe|tojson}};
        questionAnswers["agent_id"] = {{ agent_id|safe|tojson}};
        console.log("AGENT: " + questionAnswers["agent_id"]);
    }

</script>


<body >
    <div class="wrapper" >
        <header>
            <h1><b>Instructions</b></h1> <br>
               Below you will be given a dialogue that happened between two agents, <strong>Agent 1</strong> and <strong>Agent 2</strong>.
                   In this dialogue, the two agents each know 10 different people. <strong>Agent 1 </strong> does not know which 10 people <strong>Agent 2</strong>
                   knows, but <strong>Agent 1</strong> does know that she has one friend in common with <strong>Agent 2</strong>. In this dialogue
                   the two agents are collectively trying to find out which friend they have in common, by discussing information about their respective friends. <br> <br>

                   Below you are also given the friends info from one of the agents. Your job is to answer the questions
                   that follow the dialogue about this agent's behavior in the dialogue, by moving each slider appropriately. The agent's statements are highlighted in <span style="color:darkred"> red</span>. We present a short description of
                   each of the attributes we will be asking about: <br> <br>
                   <ul style="margin-left: 30px;">
                        <li>
                            <span style="color:blue"><strong>FLUENT</strong></span>: How grammatical and well-formed are the statements made by the agent sound? If the agent says
                            things like <i>Friend the is college</i>, that is <strong>very not fluent</strong>, but if they are saying things like
                            <i>Most of my friends went to Ohio State</i>, this is <strong>very fluent</strong>.
                        </li><br>
                        <li>
                            <span style="color:blue"><strong>FACTUALLY-CORRECT</strong></span>: How consistent are the statements made by the agent with their friend information? In other words,
                            are they lying? For example, if the agent is saying things like <i>I have a friend that studied biology</i> but none of their friends
                            studied biology, the agent is <strong>not very correct</strong>.
                        </li><br>
                       <li>
                            <span style="color:blue"><strong>STRATEGIC</strong></span>: How useful are the statements made by the agent? Since the two agents
                           are trying to find their common friend as quickly as possible, how good do the questions asked by the agent
                           seem and how appropriate are the agent's answers to the other agent's questions? For example, if the agent
                           has no friends that worked at McKinsey but they ask <i>How many of your friends worked at McKinsey</i>, they
                           are <strong>not very strategic</strong>.
                       </li> <br>
                       <li>
                           <span style="color:blue"><strong>HUMAN-LIKE</strong></span>: If you were talking to this agent, would you be convinced that it is a human? Many
                           of these dialogues were conducted between two Amazon Mechanical Turkers, so would you believe that the agent below
                           is a Turker?
                       </li>
                   </ul>

        </header>
        <br>
        <br>

        <!-- KBs for dialogue -->
        <div class="kb">
        <table align="middle" border="1" style="width: 100%" >
            {% if agent_id == 0 %}
            <caption> <strong> Agent 1 Friends Info </strong></caption>
            {% else %}
            <caption> <strong> Agent 2 Friends Info </strong></caption>
            {% endif %}
        <tr>
            {% for name in column_names %}
            <th>{{name}}</th>
            {% endfor %}
        </tr>
        {% for row in kb %}
        <tr>
            {% for name, value in row.items()%}
            <td> {{value}}</td>
            {% endfor %}
        </tr>
        {% endfor %}
        </table>
        </div>

        <br> <br>


        <!-- Fill in a dialogue here -->
        <div class="dialogue">
            {% for turn in dialogue %}
                {% if turn.agent == agent_id %}
                <p> <span style="color:darkred"><strong>Agent {{turn.agent + 1}}:   </strong> {{turn.data}}</span></p>
                {% else %}
                <p> <strong>Agent {{turn.agent + 1}}:   </strong> {{turn.data}}</p>
                {% endif %}
            {% endfor %}

        </div>
        <br> <br>

        <!-- Agent questions -->

         <div class="q">

            <p style="text-align:center;">How <strong>fluent</strong> is Agent {{agent_id + 1}}?</p> <br>
            <form id="q_f">
                <p style="float:left;">Not very fluent  </p>
                <input type="range" id="fluent" min="1" max="5" style="width:50%; margin-left:16%;" >
                <p style="float:right;">Very fluent</p>
            <!--<div><input type="radio" name="answer" value="1"> very non-fluent </div>-->
            <!--<div><input type="radio" name="answer" value="2"> somewhat non-fluent </div>-->
            <!--<div><input type="radio" name="answer" value="3"> in the middle </div>-->
            <!--<div><input type="radio" name="answer" value="4"> somewhat fluent </div>-->
            <!--<div><input type="radio" name="answer" value="5"> very fluent </div><br>-->
            </form>
        </div>

        <br> <br>

        <div class="q">
           <p style="text-align:center;">How <strong>factually-correct</strong> is Agent {{agent_id + 1}}?</p> <br>
            <form id="q_c">
                <p style="float:left;">Not very correct</p>
                <input type="range" id="correct" min="1" max="5" style="width:50%; margin-left:16%;" >
                <p style="float:right;">Very correct</p>
            <!--<input type="radio" name="answer" value="1"> very non-factually-correct-->
            <!--<input type="radio" name="answer" value="2"> somewhat non-factually-correct-->
            <!--<input type="radio" name="answer" value="3"> in the middle-->
            <!--<input type="radio" name="answer" value="4"> somewhat factually-correct-->
            <!--<input type="radio" name="answer" value="5"> very factually-correct-->
            </form>
        </div>

        <br> <br>

        <div class="q">
            <p style="text-align:center;">How <strong>strategic</strong> is Agent {{agent_id + 1}}?</p> <br>
            <form id="q_s">
                <p style="float:left;">Not very strategic</p>
                <input type="range" id="strategic" min="1" max="5" style="width:50%; margin-left:13%" >
                <p style="float:right;">Very strategic</p>
            <!--<input type="radio" name="answer" value="1"> very non-strategic-->
            <!--<input type="radio" name="answer" value="2"> somewhat non-strategic-->
            <!--<input type="radio" name="answer" value="3"> in the middle-->
            <!--<input type="radio" name="answer" value="4"> somewhat strategic-->
            <!--<input type="radio" name="answer" value="5"> very strategic-->
            </form>
        </div>

        <br> <br>

        <div class="q">
            <p style="text-align:center;">How <strong>human-like</strong> is Agent {{agent_id + 1}}?</p> <br>
            <form id="q_h">
                <p style="float:left;">Not very human-like</p>
                <input type="range" id="humanlike" min="1" max="5" style="width:50%; margin-left:11%;" >
                <p style="float:right;">Very human-like</p>
            <!--<input type="radio" name="answer" value="1"> very non-human-like-->
            <!--<input type="radio" name="answer" value="2"> somewhat non-human-like-->
            <!--<input type="radio" name="answer" value="3"> in the middle-->
            <!--<input type="radio" name="answer" value="4"> somewhat human-like-->
            <!--<input type="radio" name="answer" value="5"> very human-like-->
            </form>
        </div>

        <br>

        <br>


        <div class="buttons" style="text-align:center;">
         <button type="button" id="submit" >Submit HIT!</button>
        </div>

    </div>


</body>
</html>