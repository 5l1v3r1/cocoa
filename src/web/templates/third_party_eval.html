<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../static/third_party_eval.css">
    <title>Third Party Evaluation</title>
</head>

<!-- JS for maneuvering text -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>

    questionAnswers = {};

    // Ensure all questions have a selected response
    function ensureAllAnswered(){
        humanVal = $('input[type=radio]:checked', '#humanlike').val();
        correctVal = $('input[type=radio]:checked', '#correct').val();
        strategicVal = $("input[type=radio]:checked", "#strategic").val();
        fluentVal = $("input[type=radio]:checked", "#fluent").val();

        if (humanVal == null | correctVal == null | strategicVal == null | fluentVal == null){
            return false;
        }
        else{
            questionAnswers["humanlike"] = humanVal;
            questionAnswers["correct"] = correctVal;
            questionAnswers["strategic"] = strategicVal;
            questionAnswers["fluent"] = fluentVal;

            return true;
        }
    }

    $(document).ready(function() {
        $("#submit").click(function() {
            allAnswered = ensureAllAnswered()
            if (allAnswered){
                console.log(questionAnswers);
                $.ajax({
                url: "/submit",
                type: "POST",
                data: JSON.stringify(questionAnswers),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data){
                    //alert("SUCCESS");
                    console.log(JSON.stringify(data));
                    window.location.reload(true);
                },
                failure: function(){
                    console.log(":(");
                }
                })
            }else{
                alert("You have not selected an answer for every question. Please do so before submitting the HIT.");
            }

        });
    });


    function formatDialogue(){
        hiddenDialogue = $("#hiddendialogue").text();
        console.log(hiddenDialogue);
        statements = hiddenDialogue.split(";");
        for(var idx = 0; idx < statements.length; idx++){
            utterance = statements[idx];
            colonIdx = utterance.indexOf(":");
            agent = utterance.substring(0, colonIdx+1);
            rest = utterance.substring(colonIdx+1);

            $(".dialogue").append("<p>" + "<strong>" + agent + "</strong>" + rest + "</p>");
        }
    }

    window.onload = function(){
        questionAnswers["uuid"] = {{ uuid|safe|tojson}};
        questionAnswers["agent_id"] = {{ agent_id|safe|tojson}};
        console.log("AGENT: " + questionAnswers["agent_id"]);
    }

</script>


<body >
    <div class="wrapper" >
        <header>
            <h1><b>Instructions</b></h1> <br>
               <span style="text-align:center;"> Below you will be given a dialogue that happened between two agents, <strong>Agent 1</strong> and <strong>Agent 2</strong>
                   Your task is to answer the questions that follow with regards to the agents in the dialogue presented.</span> <br> <br>

                <ul style="margin-left: 30px;">
                </ul>
        </header>
        <br>
        <br>

        <!-- KBs for dialogue -->
        <div class="kb">
        <table align="middle" border="1" style="width: 100%" >
            {% if agent_id == 0 %}
            <caption> <strong> Agent 1 Info </strong></caption>
            {% else %}
            <caption> <strong> Agent 2 Info </strong></caption>
            {% endif %}
        <tr>
            {% for name in column_names %}
            <th>{{name}}</th>
            {% endfor %}
        </tr>
        {% for row in kb %}
        <tr>
            {% for name, value in row.items()%}
            <td> {{value}}</td>
            {% endfor %}
        </tr>
        {% endfor %}
        </table>
        </div>

        <br> <br>


        <!-- Fill in a dialogue here -->
        <div class="dialogue">
            {% for turn in dialogue %}
                {% if turn.agent == agent_id %}
                <p> <span style="color:darkred"><strong>Agent {{turn.agent + 1}}:   </strong> {{turn.data}}</span></p>
                {% else %}
                <p> <strong>Agent {{turn.agent + 1}}:   </strong> {{turn.data}}</p>
                {% endif %}
            {% endfor %}

        </div>
        <br>

        <!-- TODO: CHANGE FORMAT OF ANSWERS -->
        <!-- Agent questions -->

         <div class="q">

            How fluent is Agent {{agent_id + 1}}? <br>
            <form id="fluent">
            <div><input type="radio" name="answer" value="1"> very non-fluent </div>
            <div><input type="radio" name="answer" value="2"> somewhat non-fluent </div>
            <div><input type="radio" name="answer" value="3"> in the middle </div>
            <div><input type="radio" name="answer" value="4"> somewhat fluent </div>
            <div><input type="radio" name="answer" value="5"> very fluent </div><br>
            </form>
        </div>

        <br>

        <div class="q">
            How factually-correct is Agent {{agent_id + 1}}?
            <form id="correct">
            <input type="radio" name="answer" value="1"> very non-factually-correct
            <input type="radio" name="answer" value="2"> somewhat non-factually-correct
            <input type="radio" name="answer" value="3"> in the middle
            <input type="radio" name="answer" value="4"> somewhat factually-correct
            <input type="radio" name="answer" value="5"> very factually-correct
            </form>
        </div>

        <br>

        <div class="q">
            How strategic is Agent {{agent_id + 1}}?
            <form id="strategic">
            <input type="radio" name="answer" value="1"> very non-strategic
            <input type="radio" name="answer" value="2"> somewhat non-strategic
            <input type="radio" name="answer" value="3"> in the middle
            <input type="radio" name="answer" value="4"> somewhat strategic
            <input type="radio" name="answer" value="5"> very strategic
            </form>
        </div>

        <br>

        <div class="q">
            How human-like is Agent {{agent_id + 1}}?
            <form id="humanlike">
            <input type="radio" name="answer" value="1"> very non-human-like
            <input type="radio" name="answer" value="2"> somewhat non-human-like
            <input type="radio" name="answer" value="3"> in the middle
            <input type="radio" name="answer" value="4"> somewhat human-like
            <input type="radio" name="answer" value="5"> very human-like
            </form>
        </div>

        <br>

        <br>


        <div class="buttons" style="text-align:center;">
         <button type="button" id="submit" >Submit HIT!</button>
        </div>

    </div>


</body>
</html>